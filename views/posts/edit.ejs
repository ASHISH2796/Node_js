<h1>Edit Post!</h1>

<form action="/post/<%=post.id %>?_method=PUT" method="POST" enctype="multipart/form-data" id="postEditForm"> 
    <div><input type="text" name ="post[title]" value ="<%= post.title %>" placeholder="Title"></div>
    <div><input type="text" name ="post[price]" value ="<%= post.price %>" placeholder="Price"></div>
    <div><input type="file" accept="images/*" name="images" multiple  id="imageUpload"></div>
    <div>
        <% post.images.forEach((image,i)=>{%>
            <image src ="<%= image.url %>" alt="image_url">
            <lable for="image<%= i %>">Delete</lable>
            <input type="checkbox" name="deleteImage" class="imageDeleteCheckbox" id="image<%= i %>" value="image<%= image.public_id %>">
        <% });%>    
    </div>
    <div><textarea name="post[description]" placeholder="Description"><%= post.description %></textarea><div>
    <div><input type="text" name ="post[location]" value ="<%= post.location %>" placeholder="Location"></div>
    <div><input type="submit"></div>
</form>
<script>
    //find post edit form
    let postEditForm =document.getElementById('postEditForm');
    //add event listner  on submit event 
    postEditForm.addEventListener('submit',function(event){
        //find total no. of new images uploaded
        let imageUpload =document.getElementById('imageUpload').files.length;
        //find total no of existing images
        let existingImgs =document.querySelectorAll('.imageDeleteCheckbox').length;
        //find total no of potential deletion 
        let imgDeletion =document.querySelectorAll('.imageDeleteCheckbox:checked').length;
        let  newTotalImage=existingImgs+imageUpload-imgDeletion;
        if(newTotalImage > 4){
            event.preventDefault();
            let removalImgCount =newTotalImage-4;
            alert(`You need to remove atleast ${removalImgCount} no . of Image${removalImgCount===1 ? '':'s' }`);
        }
    });
</script>